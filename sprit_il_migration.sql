BEGIN
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)
Values(
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'f',
'The image runs in the router flash.',
sysdate,
'aselvara',
'V', 
'Imported by script');                                      
                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'r',                                                             
'The image runs in the router rom.',
sysdate, 
'aselvara', 
'V', 
'Imported by script');

                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'l',                                                             
'The image runs in the router relocatable.',
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      
                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'm',
'The image runs in the router ram and is uncompressed.',
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                     
                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'mz',                                                            
'The image runs in the router ram and is zip compressed.',
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      
                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'mx',
'The image runs in the router ram and is mzip compressed.',
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      
                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'mw',
'The image runs in the router ram and is "STAC" compressed.',
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      
                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'html.tar',
'HTML file in tar format.',
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      
                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'm.ucode',
null,
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      
                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'm.bin', 
null,
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      
                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'r.bin',
null,
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      
                                                                                
Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'mx.bin',
null,
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      

Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'rm',
null,
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      

Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'cip',
null,
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      

Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'RP1',
null,
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      

Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'xcpa',
null,
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      

Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)                      
Values(                                                                         
SHR_RUNS_COMP_EXTN_SEQ.nextval, 
'txt',
null,
sysdate, 
'aselvara', 
'V', 
'Imported by script');                                      

Insert into shr_runs_comp_extn( runs_comp_extn_id,
                                runs_comp_extn_name,
                                runs_comp_extn_desc,
                                adm_timestamp,
                                adm_userid,
                                adm_flag,
                                adm_comment)
Values(    
SHR_RUNS_COMP_EXTN_SEQ.nextval,
'tar',
null,
sysdate,
'aselvara',
'V',
'Imported by script');

--************************************************************************************

Insert into shr_image_type
(IMAGE_TYPE_ID,
IMAGE_TYPE_NAME,
IMAGE_TYPE_DESC,
ADM_TIMESTAMP,
ADM_USERID,
ADM_FLAG,
ADM_COMMENT)
Values(SHR_IMAGE_TYPE_SEQ.nextval,
       'I',
       'Regular',
        sysdate,
       'aselvara',
       'V',
       'Inserted by aselvara');

Insert into shr_image_type
(IMAGE_TYPE_ID,
IMAGE_TYPE_NAME,
IMAGE_TYPE_DESC,
ADM_TIMESTAMP,
ADM_USERID,
ADM_FLAG,
ADM_COMMENT)
Values(SHR_IMAGE_TYPE_SEQ.nextval,
       'B',
       'Boot',
        sysdate,
       'aselvara',
       'V',
       'Inserted by aselvara');

Insert into shr_image_type
(IMAGE_TYPE_ID,
IMAGE_TYPE_NAME,
IMAGE_TYPE_DESC,
ADM_TIMESTAMP,
ADM_USERID,
ADM_FLAG,
ADM_COMMENT)
Values(SHR_IMAGE_TYPE_SEQ.nextval,
       'S',
       'Special',
        sysdate,
       'aselvara',
       'V',
       'Inserted by aselvara');
--***********************************************************************
Insert Into shr_image_prefix
Select  SHR_IMAGE_PREFIX_SEQ.nextval,
        image_prefix,
		adm_timestamp,
		adm_flag,
		adm_userid,
		adm_comment
From   
    (Select distinct substr(image,1,decode(instr(image,'-',1,1),0,decode(instr(image,'_',1,1),0,length(image)+1
	                                                                                            ,instr(image,'_',1,1))
                                                                 ,instr(image,'-',1,1) )-1)                         image_prefix
						,sysdate                                                            adm_timestamp
						,'V'                                                                adm_flag
                                                ,'aselvara'                                                         adm_userid
						,'Migrated from SIIS image table'                                   adm_comment
        From siis_test.image);
--************************************************************************
Insert Into shr_feature_set_name
Select  shr_feature_set_name_seq.nextval,
        feature_set_name,
		adm_timestamp,
		adm_flag,
		adm_userid,
		adm_comment
From   
  (Select distinct decode(substr(image,instr(image,'-',1,1)+1,instr(image,'-',1,2)-(instr(image,'-',1,1)+1) ),null,'No Fset'
                        ,substr(image,instr(image,'-',1,1)+1,instr(image,'-',1,2)-(instr(image,'-',1,1)+1) )) feature_set_name
						,sysdate                                                            adm_timestamp
						,'V'                                                                adm_flag
                                                ,'aselvara'                                                         adm_userid
						,'Migrated from SIIS image table'                                   adm_comment
   From siis_test.image);

--************************************************************************

INSERT INTO shr_platform_family 
SELECT shr_platform_family_seq.nextval,
       platform_family_name,
       platform_family_engg_name,
       platform_family_desc,
       adm_timestamp,
       adm_userid,
       adm_flag,
       adm_comment
FROM
      (SELECT DISTINCT family             platform_family_name,
              'SIIS eng'                  platform_family_engg_name,
              'No description available'  platform_family_desc,
               sysdate                    adm_timestamp,
              'aselvara'                  adm_userid,
               'V'                        adm_flag,
              'Imported from SIIS'        adm_comment
       FROM siis_test.platform);



--****************************************************************************
INSERT INTO shr_individual_platform
SELECT shr_individual_platform_seq.nextval,
                  individual_platform_name,
                  platform_family_id,
                  cco_dir         ,
                  platform_product_family,
                  adm_timestamp,
                  adm_userid              ,
                  adm_flag           ,
                  adm_comment       
FROM
      (SELECT DISTINCT platform         individual_platform_name,
              platform_family_id,
              ccodir                      cco_dir,
              platform_product_family,
              sysdate                    adm_timestamp,
              'aselvara'                 adm_userid,
              'V'                        adm_flag,
              'Imported from SIIS'       adm_comment
       FROM       siis_test.platform a,
                  shr_platform_family b
       WHERE a.family=b.platform_family_name);
       --AND   a.platform not like '%-%');

--****************************************************************************
Insert Into shr_pf_image_prefix
Select          shr_pf_image_prefix_seq.nextval,
                platform_family_id,
                image_prefix_id,
                adm_timestamp,
                adm_flag,
                adm_userid,
                adm_comment
From   
    (Select distinct  pf.platform_family_id                  platform_family_id
	             ,pf.platform_family_name                platform_family_name
	             ,ip.image_prefix_id                     image_prefix_id
	             ,ip.image_prefix_name                   image_prefix_name
		     ,sysdate                                adm_timestamp
                     ,'V'                                    adm_flag
                     ,'aselvara'                             adm_userid
                     ,'Migrated from SIIS image table'       adm_comment
        From siis_test.feature fe,
	     shr_platform_family pf,
             shr_image_prefix ip
	where
	    (substr(image,1,decode(instr(image,'-',1,1),0,decode(instr(image,'_',1,1),0,length(image)+1
                                                                 ,instr(image,'_',1,1))
                                                                 ,instr(image,'-',1,1) )-1))=ip.image_prefix_name
         and  pf.platform_family_name=fe.family
	 and fe.obsolete='N');
--************************************************************************

--set feed off;
--set serveroutput on;
DECLARE
old_release_number_id      Number       := -1;
old_image                  Varchar2(80) :='noimage';
old_platform               Varchar2(64) :='non';
old_dram                   Number       := -1;
old_min_flash              Number       := -1;
CURSOR c1
   IS SELECT distinct r.release_number_id
      ,m.major_release_number||'('||r.zabp||')'||r.a||r.o rdaRelStr
      ,i.release||'('||i.maintenance||i.mrenumber||')'
      ||i.ed_designator||i.ed_renumber siisrel
      ,i.image
      ,i.platform
      ,i.mindram
      ,i.minflash
      ,it.image_type_id
      ,i.test
      ,i.cco
      ,i.deferral
      ,nvl(i.deferral_request_id,'N')  deferral_request_id
      ,nvl(i.swadvise,'N')             swadvise
      ,nvl(i.software_advisory_id,'N') software_advisory_id
      ,p.individual_platform_id
     ,fs.feature_set_name_id
     ,ip.image_prefix_id
FROM  shr_release_number r
     ,shr_major_release m
     ,siis_test.image i
     ,shr_individual_platform p
     ,shr_image_type it
     ,shr_feature_set_name fs
     ,shr_image_prefix ip
WHERE m.major_release_id = r.major_release_id
AND   m.major_release_number||'('||r.zabp||')'||r.a||r.o =
      i.release||'('||i.maintenance||i.mrenumber||')'||i.ed_designator
      ||i.ed_renumber
AND   i.platform =p.individual_platform_name
AND   i.category =it.image_type_name
AND   nvl(substr(i.image,instr(i.image,'-',1,1)+1,instr(i.image,'-',1,2)-(instr(i.image,'-',1,1)+1)),'No Fset')  =fs.feature_set_name
AND   substr(i.image,1,decode(instr(i.image,'-',1,1),0,decode(instr(i.image,'_',1,1),0,length(i.image)+1
	                                                                              ,instr(i.image,'_',1,1))
                                                      ,instr(i.image,'-',1,1) )-1)=ip.image_prefix_name
AND   i.obsolete='N'
AND upper(image) not like '%CIP%' 
AND upper(image) not like '%XCPA%'
AND upper(image) not like '%-RM%'
AND upper(image) not like '%_RM%'
AND upper(image) not like 'RP1'
ORDER BY 1,4,5;

BEGIN
    FOR C2 IN C1 LOOP
        IF (c2.release_number_id = old_release_number_id 
            AND c2.image        = old_image) THEN
            IF (c2.platform          = old_platform
               -- AND c2.mindram       = old_dram
               -- AND c2.minflash      = old_min_flash
               ) THEN
                NULL;
            ELSE 
                 INSERT INTO shr_platform_image
                       (platform_image_id
                       ,image_id
                       ,individual_platform_id
                       ,dram
                       ,min_flash
                       ,adm_timestamp
                       ,adm_userid
                       ,adm_flag
                       ,adm_comment
                       )
                 VALUES (shr_platform_image_seq.nextval
                        ,shr_image_seq.currval
                        ,c2.individual_platform_id
                        ,c2.mindram
                        ,c2.minflash
                        ,sysdate
                        ,'aselvara'
                        ,'V'
                        ,'Migrated from SIIS'
                       );
                old_platform  := c2.platform;
                old_dram      := c2.mindram;
                old_min_flash := c2.minflash;
            END IF;
        ELSE
           -- DBMS_OUTPUT.PUT_LINE('Inserting into both tables');
           INSERT INTO shr_image
                       ( image_id
                        ,image_prefix_id
                        ,feature_set_name_id
                        ,runs_comp_extn_id
                        ,release_number_id
                        ,image_type_id
                        ,audit_image_id
                        ,image_name
                        ,is_in_image_list
                        ,is_built_for
                        ,is_arf_devtest_ok
                        ,is_netbooted
                        ,is_going_to_CCO
                        ,is_going_to_MFG
                        ,is_cco_orderable
                        ,is_mfg_orderable
                        ,is_deferred
                        ,deferral_id
                        ,is_software_advisory
                        ,software_advisory_id
                        ,is_obsolete
                        ,on_release_archive_date
                        ,on_tftpboot_date
                        ,adm_timestamp
                        ,adm_userid
                        ,adm_flag
                        ,adm_comment
                        ,created_by
                        ,created_date
                       )
                 VALUES(shr_image_seq.nextval           --image_id
                        ,c2.image_prefix_id             -- image prefix id
                        ,c2.feature_set_name_id         -- feature set name id
                        ,1                              --runs_comp_extn_id
                        ,c2.release_number_id           --release_number_id
                        ,c2.image_type_id               --image_type_id
                        ,Null                           --audit_image_id
                        ,c2.image                       -- image_name
                        ,'Y'                            -- is_in_image_list
                        ,decode(c2.test,'Y','T','P')    -- is_built_for
                        ,NULL                           -- is_arf_devtest_ok
                        ,NULL                           -- is_netbooted
                        ,c2.cco                         -- is_going_to_cco
                        ,NULL                           -- is_going_to_mfg
                        ,NULL                           -- is_cco_orderable
                        ,NULL                           -- is_mfg_orderable
                        ,c2.deferral                    -- is_deferred
                        ,c2.deferral_request_id         -- deferral_id
                        ,c2.swadvise                    -- is_software_advisory
                        ,c2.software_advisory_id        -- software_advisory_id
                        ,'N'                            --is_obsolete
                        ,NULL                           --  on_release_archive_date
                        ,NULL                           --  on_tftpboot_date
                        ,sysdate                        --  adm_timestamp
                        ,'aselvara'                     --  adm_userid
                        ,'V'                            --  adm_flag
                        ,'Migrated from SIIS'           --  adm_comment
                        ,'aselvara'                     --  created_by
                        ,sysdate                        --  created_date
                       );
           INSERT INTO shr_platform_image
                       (platform_image_id
                       ,image_id
                       ,individual_platform_id
                       ,dram
                       ,min_flash
                       ,adm_timestamp
                       ,adm_userid
                       ,adm_flag
                       ,adm_comment
                       )
                VALUES (shr_platform_image_seq.nextval
                        ,shr_image_seq.currval
                        ,c2.individual_platform_id
                        ,c2.mindram
                        ,c2.minflash
                        ,sysdate
                        ,'aselvara'
                        ,'V'
                        ,'Migrated from SIIS'
                       );
                old_platform  := c2.platform;
                old_dram      := c2.mindram;
                old_min_flash := c2.minflash;
                old_release_number_id := c2.release_number_id;
                old_image             := c2.image;
        END IF;
     END LOOP;
END;
--***********************************************************************************************
UPDATE shr_image set runs_comp_extn_id=13
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%RM%'
and upper(image_name) not like '%MZ%';

UPDATE shr_image set runs_comp_extn_id=17
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%TXT%'
and upper(image_name) not like '%MZ%';

update shr_image set runs_comp_extn_id=16
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%CIP%'
and upper(image_name) not like '%MZ%';

update shr_image set runs_comp_extn_id=15
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%XCPA%'
and upper(image_name) not like '%MZ%';


update shr_image set runs_comp_extn_id=14
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%RP1%'
and upper(image_name) not like '%MZ%';


update shr_image set runs_comp_extn_id=9
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%M.UCODE%'
and upper(image_name) not like '%MZ%';



update shr_image set runs_comp_extn_id=7
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%MW%'
and upper(image_name) not like '%MZ%';



update shr_image set runs_comp_extn_id=6
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%MX%'
and upper(image_name) not like '%MZ%';


update shr_image set runs_comp_extn_id=5
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%-MZ%';


update shr_image set runs_comp_extn_id=4
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%-M%'
and upper(image_name) not like '%-MZ%'
and upper(image_name) not like '%-MX%'
and upper(image_name) not like '%MW%'
and upper(image_name) not like '%M.UCODE%';


update shr_image set runs_comp_extn_id=3
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%-L%'
and upper(image_name) not like '%-MZ%'
and upper(image_name) not like '%-MX%'
and upper(image_name) not like '%MW%'
and upper(image_name) not like '%M.UCODE%'
and upper(image_name) not like '%-M%';

update shr_image set runs_comp_extn_id=2
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%-R%'
and upper(image_name) not like '%-MZ%'
and upper(image_name) not like '%-MX%'
and upper(image_name) not like '%MW%'
and upper(image_name) not like '%M.UCODE%'
and upper(image_name) not like '%-M%'
and upper(image_name) not like '%-RM%';

update shr_image set runs_comp_extn_id=18
                     ,adm_comment='RNSCOMPT updated by aselvara'
where upper(image_name) like '%TAR%'
and upper(image_name) not like '%-MZ%'
and upper(image_name) not like '%-MX%'
and upper(image_name) not like '%MW%'
and upper(image_name) not like '%M.UCODE%'
and upper(image_name) not like '%-M%'
and upper(image_name) not like '%-RM%';


--***********************************************************************************************
END;
